<!DOCTYPE html>
<html lang="en">
@@include('layout/head.html', {
    'title': '發表文章'
})
<body>
    <!-- 網頁頭 by NJ -->
    @@include('layout/header.html')  
    <main id="app">
        <section class="discuss discuss_write">
            <div class="container">
                <!-- 撰寫文章區 by JC -->
                <div class="article_writing_board">
                    <!-- 選擇看板 -->
                    <div class="choose_theme">
                        <select name="topic" id="article_mine_month" v-model="topic">
                            <option selected disabled>選擇看板</option>
                            <option v-for="cate in cates" >{{cate}}</option>
                        </select>
                    </div>
                    
                    <div class="write_head">
                        <div class="author img_box">
                            <img :src="author_hat_img" alt="會員頭像">
                        </div>
                        <div class="writer_detail_box">
                            <p>{{members[0].memId}}</p>
                            <p class="getTime">{{getYear}} / {{getMonth}} / {{getDate}}</p>
                        </div>
                    </div>
                    <form action="">
                        <!-- 文章標題 -->
                        <div class="write_title">
                            <label>標題
                            <input type="text" name="title" id="write_txt_title" maxlength="20" v-model="title">
                            </label>
                        </div>
                        <!-- 寫內容的地方 -->
                        <div class="write_content" id="write_content">
                            <label>內容
                            <textarea name="content" rows="12" placeholder="請輸入文章內容..." v-model="content"></textarea>
                            </label>
                        </div>
                        <!-- 最下面 選圖片 清除 發布 -->
                        <div class="write_bottom">
                            <div class="file_insert_btn">
                                <input type="file" id="theFile">
                            </div>
                            <div class="write_using_btn">
                                <a href="discuss.html"><button class="third_btn">取消</button></a>
                                <a href="discuss.html"><button class="third_btn" @click="insertData">發佈</button></a>
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>

    </main>
    <!-- 網頁尾 By NJ -->
    @@include('layout/footer.html')
    <script>
        new Vue({
            el: '#app',
            data: { //變數放這
                cates: ['全部','塔羅秘笈','塔羅實例','愛情診療室','塔羅牌陣','占卜專區'],
                author_hat_img: 'images/black_cat_wizard.svg',
                members: [],
                getYear: new Date().getFullYear(),
                getMonth: new Date().getMonth()+1,
                getDate: new Date().getDate(),
                topic: '',
                title: '',
                content: '',
                reses: '',
            },
            mounted() {
                // let memId;
                // fetch('phps/try_fetchApi.php', 
                // { 
                //     method: 'POST', 
                //     body:encodeURI(JSON.stringify({
                //         memId: 'memId',
                //     })),
                //     headers: {
                //         'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
                //     }
                // } 
                // )
                // // .then((res) => {
                // //     console.log(res);
                // // })
                // .then((res) => {
                //     return res.json();
                // })
                // .catch((error) => {
                //     console.log(`Error: ${error}`);
                // });
                this.getMemId();
            },
            methods: {
                getMemId() {
                    let thisVue = this;
                    $.ajax({
                        type: 'POST',
                        url: 'phps/try_fetchApi.php',
                        success: function(data) {
                            console.log(data);
                            console.log(thisVue.members);
                            if (data !== false){
                                let members;
                                thisVue.members = data;
                            }
                        },
                        error: function() {
                            console.log('ajax error');
                        }
                    });
                },
                insertData() {
                    let topic = this.topicName;
                    let title = this.title;
                    let content = this.content;
                    // 檢查欄位是否已填
                    // if (!topic) {
                    //     this.resetInput('請選擇看板名稱');
                    //     return;
                    // }
                    // if(!title){
                    //     this.resetInput('請輸入標題');
                    //     return;
                    // }
                    // if(!content){
                    //     this.resetInput('請輸入內容');
                    //     return;
                    // }
                    // 新增資料
                    let thisVue = this;
                    $.ajax({
                        type: 'POST',
                        url: 'phps/insert.php',
                        data: {
                            table: 'article',
                            queryCol: 'title , content',
                            insertValue: `'${title}', '${content}'`
                        },
                        success: function(data) {
                            console.log(sql);
                            console.log(data.msg);
                            thisVue.resetInput('成功發表文章!');
                            thisVue.insertData();
                        },
                        error: function() {
                            console.log('ajax error');
                        }
                    });
                },
                resetInput(msg = false) {
                    if(msg) alert(msg);
                    console.log(msg);
                },

            },
            
        })
    </script>
</body>
</html>