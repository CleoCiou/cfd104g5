<!DOCTYPE html>
<html lang="en">

    @@include('layout/head.html', {
        'title': '全方位線上占卜共享平台'
    })

<link rel="stylesheet" href="css/index.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
<body>
    <!-- 開場動畫 -->
    <div class="opening_animation" id="video" > 
        <button class="btn_hidden other_btn"  onclick="videoHidden()">SKIP</button>
        <video autoplay muted>
            <source src="images/media/opening_animation.mp4" type="audio/ogg">
        </video>
    </div>
    
<!-- 網頁頭 by NJ -->
<!-- <header class="main_header"></header> -->
@@include('layout/header.html')

<!-- 首頁區塊 by ZH -->
<main>
    <!-- 介紹 -->
    <section class="introduce" id="int">
        <div class="container">
            <div class="introduce_box">
                <!-- 介紹_圖 -->
                <div class="introduce_img">
                        <img src="images/index/index_black_cat.svg">
                </div>
                <!-- 介紹_文 -->
                <div class="introduce_txt_box">
                    <div class="introduce_txt">
                        <h2>Mistro解星鏡</h2>
                        <h3>透過占卜與星座給予你方向與力量,<br>找到屬於自己最好的存在方式。</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 視差滾動 圈圈 -->
    <section class="scroll_circle" id="scroll">
        <!-- 視差滾動 圈圈_文 -->
        <div class="scroll_circle_txt">
            <h2>
                準備好進入占卜的世界嗎?
            </h2>
        </div>
        <!-- 視差滾動 圈圈_圖 -->
        <div class="scroll_circle_img">
            <div class="scroll_circle_big">
                <img src="images/index/index_black_bg.svg">
            </div>
            <div class="planets">
                <img src="images/index/index_planet.png" alt="行星" id="planet">
                <img src="images/index/index_full_moon.png" alt="滿月" id="full_moon">
                 <img src="images/index/index_moon.png" alt="月亮" id="moon">
                <img src="images/index/index_universe.png" alt="宇宙"
                id="universe">
            </div>
        </div>

        

    </section>

    <!-- 線上測驗 -->
    <section class="online_test" id="text">
        <div class="container">
            <div class="online_test_box">
                <div class="owl-carousel owl-theme">
                    <a href="online_divination.html">
                        <div class="test_box">
                            <div class="test_img">
                                <img src="images/index/index_text_tarot.svg">
                            </div>
                            <div class="test_txt">
                                <h2>塔羅牌</h2>
                            </div>
                        </div> 
                    </a>
                    <a href="con_today_fortune.html">
                        <div class="test_box">
                            <div class="test_img">
                                <img src="images/index/index_text_Constellation.svg">
                            </div>
                            <div class="test_txt">
                                <h2>星座</h2>
                            </div>
                        </div> 
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- 熱門占卜師 -->
    <section class="hot_fortune_teller" id="hft">
        <div class="container">

            <h1>熱門占卜師</h1>  

            <div id="hotTellerMem">
                <!-- 熱門占卜師_卡片 -->
            </div>

            <!-- 占卜師總覽 -->
            <div class="teller_verview">
                <a href="teller_mem.html"><input type="submit" id="submit" value="占卜師瀏覽" class="primary_btn"></a>
            </div>
        </div>
    </section>

    <!-- 主打商品 -->
    <section class="shopping_item" id="hp">
        <div class="container">
            <h1>主打商品</h1>
            <!-- 主打商品_卡片 -->
            <div class="product_box index_product_box" id="hotProduct">
                
            </div>
            <!-- 主打商品_手機 -->
            <div class="product_box_Mobile" id="hotProductMobile">

            </div>

            <!--商品總覽 -->
            <div class="product_overview">
                <a href="shop.html"><input type="submit" id="submit" value="商品瀏覽" class="primary_btn"></a>
            </div>
        </div>

    
    </section>

</main>


<!-- 網頁尾 By NJ -->
<!-- <footer class="main_footer"></footer> -->
@@include('layout/footer.html')


<script>

// 視差滾動 黑洞放大效果
    gsap.to('.scroll_circle_big', {
            scrollTrigger: {
                // 需要視差滾動的class
               trigger: '.scroll_circle_big',
                // 開始於頂部中心
               start:"top center",
               // 結束於y軸後200
               end: "200",
               // 打開滾動前後效果一致
               scrub: true, 
            // markers: true, // 顯示參考線
            },
            //放大幾倍
            scale: 3,
            //持續時間
            duration: 6,
            //透明度
            opacity:0
            
        });

        gsap.to('.scroll_circle_txt', {
            scrollTrigger: {
                // 需要視差滾動的class
               trigger: '.scroll_circle_txt',
               // 打開滾動前後效果一致
               scrub: true, 
            },
            //放大幾倍
            scale: 1.4,
            //持續時間
            duration: 2,
            //透明度
            opacity:0.6
            
        });

// 視差滾動 行星動
    gsap.to('#planet', {
            x: 20,
            y: 40,
            duration: 2,
            repeat: -1, 
            yoyo: true, 
        });

    gsap.to('#full_moon', {
            x: -15,
            y: 50,
            duration: 3,
            repeat: -1, 
            yoyo: true, 
        });
        
    gsap.to('#moon', {
            x: 15,
            x: 40,
            duration: 2,
            repeat: -1, 
            yoyo: true, 
        });
    
    gsap.to('#universe', {
            y: 30,
            duration: 3,
            repeat: -1, 
            yoyo: true, 
        });



    // 推薦商品 貓頭鷹套件

    $(".owl-carousel").owlCarousel({
        loop: true, // 循環播放
        margin: 10, // 外距 10px
        dots: false,
        nav: true, // 顯示點點
        responsive: {
            0: {
            items: 1 // 螢幕大小為 0~600 顯示 1 個項目
            },
            980: {
                items: 1 // 螢幕大小為 1000 以上 顯示 5 個項目
            }
        }
    });
    </script>

<!-- 撈資料庫資料 -->
<script>
// 首頁熱門占卜師
function getHotTellerMemsList() {
        $.ajax({
            type: 'POST',
            url: 'phps/select.php',
            data: {
                // 要查詢的資料表
                table: 'members',
                // 要 join 的資料表 (如果沒有就不用打)
                joinTable: 'astrologist',
                // 要查詢的欄位
                queryCol: 'astNo, memName, memImage, totalScore',
                // join 的條件 (如果沒有join就不用打)
                joinOn: 'memNo',
                condition: 'identity="占卜師" and astrologist.status = "一般"',
                other: 'ORDER BY totalScore asc limit 3'
            },
            success: function(data) {
                if (data.msg !== false){
                    // console.log(data.msg);

                    // 很多! -> 迴圈
                    let hotTellerImg = "images/member/"
                    let hotTellerMems = `<div class="hot_fortune_teller_box">`;
                    for (let i = 0; i < data.msg.length; i++) {
                        hotTellerMems +=   `
                                    <a href="teller_reservation.html?type=${data.msg[i].astNo - 1}">
                                    <div class="hot_fortune_teller_card">
                                        <div class="hot_fortune_teller_img">
                                            <img src="${hotTellerImg}${data.msg[i].memImage}">
                                        </div>
                                        <div class="hot_fortune_teller_txt">
                                            <h3>${data.msg[i].memName}</h3>
                                        </div>
                                        <div class="hot_fortune_teller_icon">
                                            <img src="images/icon/icon_shop_eye.svg">
                                        </div>
                                    </div>
                                </a>  
                                `;
                }
                hotTellerMems += `</div>`
                $('#hotTellerMem').append(hotTellerMems)
                }
            },
            error: function() {
                console.log('ajax error');
            }
        });
    }
    // 何時要?
    window.addEventListener('load', getHotTellerMemsList);



// 主打商品
function getProduct() {
  $.ajax({
      type: 'POST',
      url: 'phps/select.php',
      
      data: {
          table: 'product',
          joinTable: 'product_category',
          queryCol: "product.prodImage1 ,product_category.cateType, product_category.cateName, product.prodName, FORMAT(price, 'C') price , product.prodspec, product.prodIntro,product.prodNo",
          joinOn: 'prodCateNo',
          other: ' ORDER BY  RAND() limit 4',
      },

      success: function(data) {
          if (data.msg !== false){
            //   console.log(data.msg);
              // 照片路徑變數  
              let productImg = "images/shop/tarot/";
              // -要包最外層的div-
              // 商城
              let shopRow = ` <div class="row shopRow">`;
              for (let i = 0; i < data.msg.length; i++) {
                shopRow +=   `
                  <a class="item">
                    <div class="img_box">
                      <div class="prod_No">${data.msg[i].prodNo}</div>
                        <span>
                            <img src="${productImg}${data.msg[i].prodImage1}" />
                            <div class="txt_box">
                                <h4>${data.msg[i].cateType}${data.msg[i].cateName} - ${data.msg[i].prodName}</h4>
                                <p>NT$ ${data.msg[i].price}</p>
                            </div>
                        </span>
                    </div>
                    <div class="eyes_icon_box">
                      <span><img src="images/icon/icon_shop_eye.svg"></span>
                    </div>
                  </a>
                  `;
              }
              shopRow += `</div>`;
              $('#hotProduct').append(shopRow);   
          }
      },
      error: function() {
          console.log('ajax error');
      }
  });
}

// 主打商品切換到商品頁面使用click事件
$(document).on('click','product_box .item',function(){
  // alert($(this).find('.prod_No').text());
  localStorage.setItem('prodNumber',$(this).find('.prod_No').text());
  window.location.href = "product.html";
});
window.addEventListener('load', getProduct);

// 主打商品手機版
function getProductMobile() {
    $.ajax({
        type: 'POST',
        url: 'phps/select.php',
        
        data: {
            table: 'product',
            joinTable: 'product_category',
            queryCol: "product.prodImage1 ,product_category.cateType, product_category.cateName, product.prodName, FORMAT(price, 'C') price , product.prodspec, product.prodIntro,product.prodNo",
            joinOn: 'prodCateNo',
            other: ' ORDER BY  RAND() limit 4',
        },

        success: function(data) {
            if (data.msg !== false){
                // console.log(data.msg);
                let productImg = "images/shop/tarot/";
                let owlTheme = `<div class="productmb owl-carousel owl-theme row  ">`;
                    for (let i = 0; i < data.msg.length; i++) {
                    owlTheme +=   `
                    <a class="item">
                        <div class="img_box">
                            <div class="prod_No">${data.msg[i].prodNo}</div>
                                <span>
                                    <img src="${productImg}${data.msg[i].prodImage1}" />
                                    <div class="txt_box">
                                        <h4>${data.msg[i].cateType}${data.msg[i].cateName} - ${data.msg[i].prodName}</h4>
                                        <p>NT$ ${data.msg[i].price}</p>
                                    </div>
                                </span>
                            </div>
                        <div class="eyes_icon_box">
                            <span><img src="images/icon/icon_shop_eye.svg"></span>
                        </div>
                  </a>
                    `;
                    }
                    owlTheme += `</div>`;

                $('#hotProductMobile').append(owlTheme);

                $(".owl-carousel").owlCarousel({
                    loop: false, // 循環播放
                    margin: 10,
                    dots: false,
                    nav: true, // 顯示點點
                    responsive: {
                        0: {
                            items:1 // 螢幕大小為 0~600 顯示 1 個項目
                        },
                        980: {
                            items:1 // 螢幕大小為 1000 以上 顯示 5 個項目
                        }
                    }
                });
            }
        },
        error: function() {
            console.log('ajax error');
        }
    });
}

// 商城切換到商品頁面使用click事件
$(document).on('click','.product_box .item',function(){
    // alert($(this).find('.prod_No').text());
    localStorage.setItem('prodNumber',$(this).find('.prod_No').text());
    window.location.href = "product.html";
});
window.addEventListener('load', getProductMobile);



// 開場動畫
//先執行外面closeVideo載入完成後  跑出裡面fadeOut淡出功能
window.addEventListener('load',closeVideo);
function closeVideo(){
    setTimeout(function(){
        $('.opening_animation').fadeOut(1000)
    }, 6000);
}

//開場動畫SKIP
function videoHidden() {
   document.getElementById('video').style.display = "none";
}

</script>
</body>
</html>