<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./css/style.css">
    <!-- <link rel="stylesheet" href="./css/draw_cards.css"> -->
    <title>解星鏡 Mistro | 塔羅</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <!-- 瀏覽器頁籤圖示由 common.js 插入 by PIN -->
</head>
<body>
    
<!-- header -->
<!-- 網頁頭 by NJ-->
<header class="main_header">


    <!-- main logo -->
    <div class="header_all">
        <!-- main logo -->
        <div class="header_img_box">
            <a href="index.html" class="logo">
                <img src="./images/index_logo_golden-02.png" alt="mistro logo">
            </a>
        </div>
            <!-- icon -->
        <div class="header_bar">
            <div class="header_icon">
                <a href="login.html"><p>登入</p></a>
                <a href="member.html"><img src="./images/header/header-member-02.png" alt="會員icon"></a>
                <a href="shopping_cart.html"><img src="./images/header/header_shopping cart.png" alt="購物車icon"></a>
            </div>
        

            <!-- 漢堡 -->
            <div class="ham_menu">
                <input id="nav_toggle" type="checkbox">
                <label for="nav_toggle" class="ham no_style">
                    <div class="ham_origin">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </label>
                <!-- 電腦選單 -->
                <nav class="menu">
                    <div class="crystal_ball">
                    </div>
                    <div class="rotate_card">
                        <a href="be_teller.html">
                            <div class="menu_card tarot"></div>
                        </a>
                        <a href="con_today_fortune.html">
                            <div class="menu_card zodiac"></div>
                        </a>
                        <a href="shop.html">
                            <div class="menu_card shop"></div>
                        </a>
                    </div>
                    <!-- 手機選單 -->
                    <ul class="menu_list">
                        <li class="menu_item">
                            <a class="menu_link" href="#">
                                塔羅
                            </a>
                            <ul class="sub_menu">
                                <li><a href="be_teller.html">體驗占卜師</a></li>
                                <li><a href="online_divination.html">線上占卜</a></li>
                                <li><a href="teller_reservation.html">預約占卜師</a></li>
                            </ul>
                        </li>
                        <li class="menu_item">
                            <a class="menu_link" href="#">
                                星座</a>
                            <ul class="sub_menu">
                                <li><a href="con_today_fortune.html">每日運勢</a></li>
                                <li><a href="con_real_constellation.html">真實星座測驗</a></li>
                                <li><a href="con_pair.html">星座配對</a></li>
                                <li><a href="discuss.html">討論區</a></li>
                            </ul>
                        </li>
                        <li class="menu_item">
                        <a class="menu_link" href="shop.html">
                            商城</a>
                        </li>
                        <li class="menu_item">
                            <a class="menu_link menu_member" href="#">會員專區</a>
                            <ul class="sub_menu">
                                <li><a href="member.html">個人資訊</a></li>
                                <li><a href="mem_reservation.html">我的預約</a></li>
                                <li><a href="mem_orders.html">我的訂單</a></li>
                                <li><a href="teller_mem.html">占卜師專區</a></li>
                            </ul>
                        </li>
                        <li class="menu_item">
                        <a class="menu_link menu_login" href="login.html">登入</a>
                        <a class="menu_link menu_login" href="login.html">註冊</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>


</header>

<!-- <script src="js/common.js"></script> -->
<script src="js/jquery.js"></script>
<script>
    $('.menu_link').click(function(){
        $('.sub_menu').slideUp();
        $(this).siblings('.sub_menu').slideToggle();
    })
</script>

<!-- 線上占卜 by NJ -->
<main>
    <section class="draw_cards">
        <div class="container">

    		<!-- 抽牌 -->
            <div class="cards_box">
                <p>請選擇一張牌</p>
				
				<!-- 抽牌圈 -->
                <div class="all">
                    <ul class="cards"></ul>
                </div>

				<!-- 占卜詳解 -->
				<!-- <div class="content_box">
					<div class="lightbox" id="popup">
						<h2>解牌</h2>
						<div class="content">
							<div class="item">
								<div class="img_box">
									<img src="https://picsum.photos/150/250/?random=10" alt="請幫每張圖片加破圖註解">
								</div>
								<div class="txt_box">
									<h3>愚者</h3>
									<p>愚者塔羅牌意義：旅程<br>
									它表明您希望尋求未來的機會，但缺乏明確的具體計劃。由於你沒有什麼顧慮，有時這些特質反而會給你帶來意想不到的成功。然而沒有遠見，使你容易產生動搖，當遇到太多障礙的時候往往會失去原有的目標。 當你想要開始諸如學習，搬家或簽署商業協議之類的，追隨你的直覺並付出行動是不錯的方式。</p>
								</div>
							</div>

							<div class="products_item">
								<div class="img_box">
									<img src="https://picsum.photos/300/250/?random=10" alt="商品圖">
								</div>
								<div class="txt_box">
									<h3>推薦商品</h3>
									<p>幸運手環
										Lorem ipsum, dolor sit amet consectetur adipisicing elit. Ullam veritatis aperiam nulla, perspiciatis excepturi at id ratione consequuntur? Iusto atque eos minima officiis eum deleniti voluptas quibusdam soluta at laboriosam.
									</p>
								</div>
							</div>
						</div>
						<p class="button_panel">
							<a href="draw_cards_old.html"><button type="button" class="second_btn lightbox_close">重新抽牌</button></a>
							<a href="teller_mem.html"><button type="button" class="second_btn ">占卜師總覽</button></a>
							<a href="be_teller.html"><button type="button" class="second_btn ">體驗占卜師</button></a>
							<a href=""><button type="button" class="second_btn ">前往商城</button></a>
						</p>
					</div>
				</div> -->
            </div>

			<!-- 占卜詳解 -->
			<div class="detail_box">
				<div class="img_box">
					<div class="item font">
						<img src="./images/tarot_cards/00The_fool.png">
					</div>
					<div class="item back">
						<img src="./images/draw_cards/draw_cards_back.jpg">
					</div>
				</div>
			</div>

        </div>
    </section>
</main>

<!-- footer -->
<!-- 網頁尾  by NJ-->
<footer class="main_footer">
    <hr>
    <div class="footer_up">
        
        <a href="#" class="footer_logo">
            <img src="./images/logo_golden.png" alt="解星鏡logo">
        </a>
        
        <div class="footer_nav">
            <ul>
                <li><a href="index.html#int">介紹</a></li>
                <li><a href="index.html#text">占卜</a></li>
                <li><a href="index.html#text">星座</a></li>
                <li><a href="index.html#hft">熱門占卜師</a></li>
                <li><a href="index.html#hp">主打商品</a></li>
                <li><a href="member.html">會員中心</a></li>
            </ul>
        </div>

        <div class="footer_icon">
            <a href=""><img src="./images/footer/icon-fb.png" alt=""></a>
            <a href=""><img src="./images/footer/icon-ig.png" alt=""></a>
            <a href=""><img src="./images/footer/icon-yt.png" alt=""></a>
        </div>
    </div>

    <div class="footer_down">
        <div class="footer_txt_box">
            <p>
                本網站為緯育TibaMe_前端設計工程師班第73期第五組學員專題成果作品，本平台僅供學習、展示之用。若有牴觸有關著作權，或有第三人主張侵害智慧財產權等情事，若有侵權疑慮，請私訊
                <a href="https://www.tibame.com/goodjob/frontend">[TibaMe-前端設計工程師養成班]</a>，後續由專人協助處理。
                <br>
                <br>
                Copyright © 2022 ft. All rights reserved.
            </p>
        </div>
    </div>
</footer>

<script>
	// 牌數
	const CARDINDEX = 22;
	// 抽牌圈
	const CARDSEL = document.querySelector('.cards');
	// 預選牌
	let selectedIndex = 0;
	// 設定抽牌圈牌數
	CARDSEL.style.setProperty('--event-count', CARDINDEX);
	// 抽牌提示
	let words = document.querySelector('.cards_box > p');
	let wordsTween;
	// 解牌提示
	let clickSelected;

	init();
	function init() {
		// 創造抽牌圈
		for(let i = 0; i < CARDINDEX; i++) {
			const EVENTEL = document.createElement('li');
			EVENTEL.classList.add('event');
			// 設定牌的旋轉角度
			EVENTEL.style.setProperty('--event-index', i);
			// 抽牌放中間
			EVENTEL.addEventListener('click',selectCard);
			// 創造牌的背景圖片
			const IMGEL = document.createElement('img');
			IMGEL.src = './images/draw_cards/draw_cards_back.jpg';
			// 將圖片放在牌上
			EVENTEL.append(IMGEL);
			// 將牌放進抽牌圈
			CARDSEL.append(EVENTEL);
		}

		wordsTween =TweenMax.to(words, {opacity: 0, duration: 2, repeat: -1, yoyo: true});
		// gsap.to($("ul.cards"), {rotate: 360, duration: 100, repeat: -1})
	}

	function selectCard(e) {

		// 取得選擇的卡片
		let card = e.target.parentNode;
		let idx = card.style.getPropertyValue('--event-index');

		// 關閉抽卡提示
		wordsTween.kill();
		words.style.opacity = 0;
		// words.innerText = '解牌';
		// words.classList.add('ans');

		// 抽牌圈數量
		let allCard = document.querySelectorAll('li.event');

		// 若選擇抽出來的卡，顯示解析
		if (card.classList.contains('selected')) {
			gsap.to(CARDSEL, {
				rotate: 10
			})
			gsap.to($('ul > li.event:not(.selected)'), {
				'--scale': 0
			})
			gsap.to($('ul > li.event.selected'), {
				rotate: 260
			})
			// 加入一點點的動畫畫畫畫畫
			gsap.set('ul', {transformStyle: 'reserve-3d'});
			gsap.set('li.event.selected', {rotationX: 0, transition: 0})
			gsap.to('li.event.selected', {
				duration: 1,
				rotationX: 720,
				scale: 3,
				boxShadow: '0 0 5px 0.5em #CFB886',
				ease: Power1.easeOut,

			// 	// 或是可以改成釘在卡片上面
				onComplete: showDetail
			});

			return false;
		}

		// 若已有選擇卡片，使其復位，刪除該牌解牌提示特效
		let selectedCard = document.querySelector('.selected');
		if (selectedCard) {
			selectedCard.classList.remove('selected');
			selectedCard.style.removeProperty('transform');

			// 一圈22張牌
			card.parentNode.style.setProperty('--event-count', 22);
			// 取得先前選到牌的編號
			let selectedIdx = selectedCard.style.getPropertyValue('--event-index');
			// 移除解牌提示
			selectedCard.removeAttribute('style');
			clickSelected.kill(selectedCard);
			for (let i = (parseInt(selectedIdx)); i < 22; i++) {
				// 抽出牌後面牌的號碼往後歸位
				allCard[i].style.setProperty('--event-index', i);
			}
		}

		// 設定選擇卡片出來的旋轉方向
		card.classList.add('selected');
		if (idx > 10) {
			// 左邊抽牌出來順時針旋轉
			card.style.transform = 'rotate(360deg)';
		}
		else {
			// 右邊抽牌出來逆時針旋轉
			card.style.transform = 'none';
		}

		// 抽一張牌，一圈剩21張牌
		card.parentNode.style.setProperty('--event-count', 21);
		for (let i = (parseInt(idx) + 1); i < 22; i++) {
			// 抽出牌後面的牌編號往前補位
			allCard[i].style.setProperty('--event-index', i-1);
		}

		// 解牌提示特效
		clickSelected = TweenMax.to(card, {duration: 1, repeat: -1, boxShadow: '0 0 10px 0.5em #CFB886CC', yoyo: true});
	}

	function showDetail() {
		// 取得選擇的卡片
		let card = document.querySelector('li.event.selected');
		// 關閉解牌提示特效
		clickSelected.kill();
		card.removeAttribute('style');

		// 取得解牌詳解容器，設定位置至抽到的卡
		// 讓抽到的牌消失: 因為他兩面是一樣的
		// 容器分正反面，翻過來會有詳解
		// 顯示容器
		let detailBox = document.querySelector('.detail_box .img_box');
		$('.detail_box .img_box').css({
			width: card.getBoundingClientRect().width,
			height: card.getBoundingClientRect().height,
			top: card.getBoundingClientRect().top,
			left: card.getBoundingClientRect().left,
		});

		detailBox.parentNode.style.display = 'block';
		$('ul.cards').css({display: 'none'});

		// 設定轉場動畫讓視覺看起來順暢
		gsap.fromTo(detailBox, {
			rotationY: 0,
			boxShadow: '0 0 20px .5em #CFB88688',
		}, 
		{
			rotationY: 180,
			translateX: '20vw',
			boxShadow: '0 0 20px 1em #CFB88688',
			duration: 1,
		})

		gsap.to($('.detail_box'), {
			duration: 1,
			backgroundColor: '#5555'
		})
		
	}
</script>

</body>
</html>