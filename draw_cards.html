<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/draw_cards.css">
    <title>解星鏡 Mistro | 塔羅</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <!-- 瀏覽器頁籤圖示由 common.js 插入 by PIN -->
</head>
<body>
    
<!-- header -->

<!-- 線上占卜 by NJ -->
<main>
    <section class="draw_cards">
        <div class="container">

    		<!-- 抽牌 -->
            <div class="cards_box">
                <h2>抽牌</h2>
                
				<!-- 抽牌圈 -->
                <div class="all">
                    <ul class="cards">
                        <div class="selected-event"></div>
                    </ul>
                </div>

				<!-- 占卜詳解 -->
				<div class="content_box">
					<div class="lightbox" id="popup">
						<h2>解牌</h2>
						<div class="content">
							<div class="item">
								<div class="img_box">
									<img src="https://picsum.photos/150/250/?random=10" alt="請幫每張圖片加破圖註解">
								</div>
								<div class="txt_box">
									<h3>愚者</h3>
									<p>愚者塔羅牌意義：旅程<br>
									它表明您希望尋求未來的機會，但缺乏明確的具體計劃。由於你沒有什麼顧慮，有時這些特質反而會給你帶來意想不到的成功。然而沒有遠見，使你容易產生動搖，當遇到太多障礙的時候往往會失去原有的目標。 當你想要開始諸如學習，搬家或簽署商業協議之類的，追隨你的直覺並付出行動是不錯的方式。</p>
								</div>
							</div>

							<div class="products_item">
								<div class="img_box">
									<img src="https://picsum.photos/300/250/?random=10" alt="商品圖">
								</div>
								<div class="txt_box">
									<h3>推薦商品</h3>
									<p>幸運手環
										Lorem ipsum, dolor sit amet consectetur adipisicing elit. Ullam veritatis aperiam nulla, perspiciatis excepturi at id ratione consequuntur? Iusto atque eos minima officiis eum deleniti voluptas quibusdam soluta at laboriosam.
									</p>
								</div>
							</div>
						</div>
						<p class="button_panel">
							<a href="draw_cards_old.html"><button type="button" class="second_btn lightbox_close">重新抽牌</button></a>
							<a href="teller_mem.html"><button type="button" class="second_btn ">占卜師總覽</button></a>
							<a href="be_teller.html"><button type="button" class="second_btn ">體驗占卜師</button></a>
							<a href=""><button type="button" class="second_btn ">前往商城</button></a>
						</p>
					</div>
				</div>
            </div>

        </div>
    </section>
</main>

<!-- footer -->

<script>
	// 牌數
	const CARDINDEX = 22;
	// 抽牌圈
	const CARDSEL = document.querySelector('.cards');
	// 預選牌
	let selectedIndex = 0;
	// 設定抽牌圈牌數
	CARDSEL.style.setProperty('--event-count', CARDINDEX);

	init();
	function init() {
		// 創造抽牌圈
		for(let i = 0; i < CARDINDEX; i++) {
			const EVENTEL = document.createElement('li');
			EVENTEL.classList.add('event');
			// 設定牌的旋轉角度
			EVENTEL.style.setProperty('--event-index', i);
			// 抽牌放中間
			EVENTEL.addEventListener('click',selectCard);
			// 創造牌的背景圖片
			const IMGEL = document.createElement('img');
			IMGEL.src = './images/draw_cards/draw_cards_back.jpg';
			// 將圖片放在牌上
			EVENTEL.append(IMGEL);
			// 將牌放進抽牌圈
			CARDSEL.append(EVENTEL);
		}
	}

	function selectCard(e) {

		// 取得選擇的卡片
		let card = e.target.parentNode;
		let idx = card.style.getPropertyValue('--event-index');

		// 抽牌圈數量
		let allCard = document.querySelectorAll('li.event');

		// 若選擇抽出來的卡，顯示解析
		if (card.classList.contains('selected')) {
			// 加入一點點的動畫畫畫畫畫
			gsap.set('.all', {perspective: 500});
			gsap.set('ul', {transformStyle: 'reserve-3d'});
			gsap.to('li.event.selected', {
				duration: 1,
				rotationX: -900,
				scale: 3,
				// ease:Back.easeOut,
				// 或是可以改成釘在卡片上面
				onComplete: () => document.querySelectorAll('.content_box')[0].style.display = 'block',
			});

			return false;
		}

		// 若已有選擇卡片，使其復位
		let selectedCard = document.querySelector('.selected');
		if (selectedCard) {
			selectedCard.classList.remove('selected');
			selectedCard.style.removeProperty('transform');

			// 一圈22張牌
			card.parentNode.style.setProperty('--event-count', 22);
			// 取得先前選到牌的編號
			let selectedIdx = selectedCard.style.getPropertyValue('--event-index');
			for (let i = (parseInt(selectedIdx)+1); i < 22; i++) {
				// 抽出牌後面牌的號碼往後歸位
				allCard[i].style.setProperty('--event-index', i);
			}
		}

		// 設定選擇卡片出來的旋轉方向
		card.classList.add('selected');
		if (idx > 10) {
			// 左邊抽牌出來順時針旋轉
			card.style.transform = 'rotate(360deg)';
		}
		else {
			// 右邊抽牌出來逆時針旋轉
			card.style.transform = 'none';
		}

		// 抽一張牌，一圈剩21張牌
		card.parentNode.style.setProperty('--event-count', 21);
		for (let i = (parseInt(idx) + 1); i < 22; i++) {
			// 抽出牌後面的牌編號往前補位
			allCard[i].style.setProperty('--event-index', i-1);
		}
	}
</script>

</body>
</html>